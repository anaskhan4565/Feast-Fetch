@page
@model FeastFetch.Pages.CartModel
@{
    ViewData["Title"] = "Shopping Cart";
}

<div class="page-header text-white text-center">
    <div class="container">
        <h1 class="display-3 fw-bold"><i class="bi bi-cart3 me-3"></i>Your Cart</h1>
        <p class="lead">Review your order before checkout</p>
    </div>
</div>

<div class="container py-5">
    <div class="row g-4">
        <!-- Cart Items -->
        <div class="col-lg-8">
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="bi bi-bag-check me-2"></i>Cart Items</h4>
                </div>
                <div class="card-body p-4">
                    <div id="cartItems">
                        <!-- Cart items will be dynamically inserted here -->
                    </div>
                    <div id="emptyCart" class="text-center py-5" style="display: none;">
                        <i class="bi bi-cart-x display-1 text-muted"></i>
                        <h3 class="mt-3 text-muted">Your cart is empty</h3>
                        <p class="text-muted">Add some delicious items to get started!</p>
                        <a href="/Restaurants" class="btn btn-primary btn-lg mt-3">
                            <i class="bi bi-search me-2"></i>Browse Restaurants
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="col-lg-4">
            <div class="card shadow-lg border-0 sticky-cart-summary">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0"><i class="bi bi-receipt me-2"></i>Order Summary</h4>
                </div>
                <div class="card-body p-4">
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Delivery Fee</span>
                        <span id="deliveryFee">$2.99</span>
                    </div>
                    <div class="summary-row">
                        <span>Service Fee</span>
                        <span id="serviceFee">$1.50</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax (10%)</span>
                        <span id="tax">$0.00</span>
                    </div>
                    <hr>
                    <div class="summary-row total-row">
                        <span class="fw-bold">Total</span>
                        <span class="fw-bold" id="total">$0.00</span>
                    </div>
                    
                    <div class="promo-code-section mt-4">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Promo Code" id="promoCode">
                            <button class="btn btn-outline-primary" type="button" onclick="applyPromo()">
                                <i class="bi bi-tag"></i> Apply
                            </button>
                        </div>
                        <div id="promoMessage" class="mt-2"></div>
                    </div>
                    
                    <a href="/Checkout" class="btn btn-success btn-lg w-100 mt-4" id="checkoutBtn">
                        <i class="bi bi-credit-card me-2"></i>Proceed to Checkout
                    </a>
                    <a href="/Restaurants" class="btn btn-outline-primary w-100 mt-2">
                        <i class="bi bi-plus-circle me-2"></i>Add More Items
                    </a>
                </div>
            </div>

            <!-- Delivery Info -->
            <div class="card shadow-lg border-0 mt-4">
                <div class="card-body p-4">
                    <h5 class="mb-3"><i class="bi bi-truck me-2"></i>Delivery Information</h5>
                    <div class="delivery-info-item">
                        <i class="bi bi-clock-fill text-primary"></i>
                        <div>
                            <strong>Estimated Time</strong>
                            <p class="mb-0 text-muted">30-40 minutes</p>
                        </div>
                    </div>
                    <div class="delivery-info-item">
                        <i class="bi bi-geo-alt-fill text-danger"></i>
                        <div>
                            <strong>Delivery Address</strong>
                            <p class="mb-0 text-muted">123 Main Street, City</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const deliveryFee = 2.99;
        const serviceFee = 1.50;
        const taxRate = 0.10;
        let promoDiscount = 0;
        
        function renderCart() {
            const cartItemsContainer = document.getElementById('cartItems');
            const emptyCartMessage = document.getElementById('emptyCart');
            
            if (cart.length === 0) {
                cartItemsContainer.style.display = 'none';
                emptyCartMessage.style.display = 'block';
                document.getElementById('checkoutBtn').style.display = 'none';
                return;
            }
            
            cartItemsContainer.style.display = 'block';
            emptyCartMessage.style.display = 'none';
            document.getElementById('checkoutBtn').style.display = 'block';
            
            cartItemsContainer.innerHTML = cart.map((item, index) => `
                <div class="cart-item">
                    <div class="cart-item-details">
                        <h5 class="cart-item-name">${item.name}</h5>
                        <p class="cart-item-price">$${item.price.toFixed(2)} each</p>
                    </div>
                    <div class="cart-item-actions">
                        <div class="quantity-controls">
                            <button class="qty-btn" onclick="updateQuantity(${index}, -1)">
                                <i class="bi bi-dash"></i>
                            </button>
                            <span class="quantity">${item.quantity}</span>
                            <button class="qty-btn" onclick="updateQuantity(${index}, 1)">
                                <i class="bi bi-plus"></i>
                            </button>
                        </div>
                        <div class="cart-item-total">
                            $${(item.price * item.quantity).toFixed(2)}
                        </div>
                        <button class="btn-remove" onclick="removeItem(${index})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            updateSummary();
        }
        
        function updateQuantity(index, change) {
            cart[index].quantity += change;
            
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
        }
        
        function removeItem(index) {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
        }
        
        function updateSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * taxRate;
            const total = subtotal + deliveryFee + serviceFee + tax - promoDiscount;
            
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('deliveryFee').textContent = `$${deliveryFee.toFixed(2)}`;
            document.getElementById('serviceFee').textContent = `$${serviceFee.toFixed(2)}`;
            document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;
        }
        
        function applyPromo() {
            const promoCode = document.getElementById('promoCode').value.toUpperCase();
            const promoMessage = document.getElementById('promoMessage');
            
            if (promoCode === 'FEAST20') {
                promoDiscount = 10;
                promoMessage.innerHTML = '<div class="alert alert-success p-2 mb-0"><i class="bi bi-check-circle me-1"></i>Promo code applied! $10 discount</div>';
                updateSummary();
            } else if (promoCode === 'FIRST50') {
                promoDiscount = 5;
                promoMessage.innerHTML = '<div class="alert alert-success p-2 mb-0"><i class="bi bi-check-circle me-1"></i>Promo code applied! $5 discount</div>';
                updateSummary();
            } else if (promoCode === '') {
                promoMessage.innerHTML = '<div class="alert alert-warning p-2 mb-0"><i class="bi bi-exclamation-triangle me-1"></i>Please enter a promo code</div>';
            } else {
                promoMessage.innerHTML = '<div class="alert alert-danger p-2 mb-0"><i class="bi bi-x-circle me-1"></i>Invalid promo code</div>';
            }
            
            setTimeout(() => {
                if (!promoMessage.querySelector('.alert-success')) {
                    promoMessage.innerHTML = '';
                }
            }, 3000);
        }
        
        // Initial render
        renderCart();
    </script>
}

