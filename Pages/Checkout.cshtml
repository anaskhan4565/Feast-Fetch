@page
@model FeastFetch.Pages.CheckoutModel
@{
    ViewData["Title"] = "Checkout";
}

<div class="page-header text-white text-center">
    <div class="container">
        <h1 class="display-3 fw-bold"><i class="bi bi-credit-card me-3"></i>Checkout</h1>
        <p class="lead">Complete your order</p>
    </div>
</div>

<div class="container py-5">
    <div class="row g-4">
        <!-- Checkout Form -->
        <div class="col-lg-8">
            <!-- Delivery Details -->
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="bi bi-geo-alt me-2"></i>Delivery Details</h4>
                </div>
                <div class="card-body p-4">
                    <form id="checkoutForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Full Name</label>
                                <input type="text" class="form-control form-control-lg" placeholder="John Doe" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Phone Number</label>
                                <input type="tel" class="form-control form-control-lg" placeholder="+1 (555) 123-4567" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold">Delivery Address</label>
                                <input type="text" class="form-control form-control-lg" placeholder="123 Main Street" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">City</label>
                                <input type="text" class="form-control form-control-lg" placeholder="New York" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">ZIP Code</label>
                                <input type="text" class="form-control form-control-lg" placeholder="10001" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold">Delivery Instructions (Optional)</label>
                                <textarea class="form-control" rows="3" placeholder="Ring the doorbell, Leave at door, etc."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Payment Method -->
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0"><i class="bi bi-wallet2 me-2"></i>Payment Method</h4>
                </div>
                <div class="card-body p-4">
                    <div class="payment-methods">
                        <div class="payment-option active" onclick="selectPaymentMethod(this, 'card')">
                            <i class="bi bi-credit-card-2-front payment-icon"></i>
                            <div class="payment-details">
                                <strong>Credit/Debit Card</strong>
                                <p class="mb-0 text-muted small">Visa, MasterCard, AmEx</p>
                            </div>
                            <i class="bi bi-check-circle check-icon"></i>
                        </div>

                        <div class="payment-option" onclick="selectPaymentMethod(this, 'paypal')">
                            <i class="bi bi-paypal payment-icon"></i>
                            <div class="payment-details">
                                <strong>PayPal</strong>
                                <p class="mb-0 text-muted small">Fast & Secure</p>
                            </div>
                            <i class="bi bi-check-circle check-icon"></i>
                        </div>

                        <div class="payment-option" onclick="selectPaymentMethod(this, 'wallet')">
                            <i class="bi bi-wallet payment-icon"></i>
                            <div class="payment-details">
                                <strong>Digital Wallet</strong>
                                <p class="mb-0 text-muted small">Apple Pay, Google Pay</p>
                            </div>
                            <i class="bi bi-check-circle check-icon"></i>
                        </div>

                        <div class="payment-option" onclick="selectPaymentMethod(this, 'cash')">
                            <i class="bi bi-cash payment-icon"></i>
                            <div class="payment-details">
                                <strong>Cash on Delivery</strong>
                                <p class="mb-0 text-muted small">Pay when you receive</p>
                            </div>
                            <i class="bi bi-check-circle check-icon"></i>
                        </div>
                    </div>

                    <!-- Card Details (shown when card is selected) -->
                    <div id="cardDetails" class="mt-4">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label fw-bold">Card Number</label>
                                <input type="text" class="form-control form-control-lg" placeholder="1234 5678 9012 3456" maxlength="19">
                            </div>
                            <div class="col-md-8">
                                <label class="form-label fw-bold">Expiry Date</label>
                                <input type="text" class="form-control form-control-lg" placeholder="MM/YY" maxlength="5">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">CVV</label>
                                <input type="text" class="form-control form-control-lg" placeholder="123" maxlength="3">
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold">Card Holder Name</label>
                                <input type="text" class="form-control form-control-lg" placeholder="JOHN DOE">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="col-lg-4">
            <div class="card shadow-lg border-0 sticky-cart-summary">
                <div class="card-header bg-warning text-dark">
                    <h4 class="mb-0"><i class="bi bi-receipt me-2"></i>Order Summary</h4>
                </div>
                <div class="card-body p-4">
                    <div id="orderItems" class="mb-3">
                        <!-- Order items will be inserted here -->
                    </div>
                    
                    <hr>
                    
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Delivery Fee</span>
                        <span>$2.99</span>
                    </div>
                    <div class="summary-row">
                        <span>Service Fee</span>
                        <span>$1.50</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax (10%)</span>
                        <span id="tax">$0.00</span>
                    </div>
                    <hr>
                    <div class="summary-row total-row">
                        <span class="fw-bold fs-5">Total</span>
                        <span class="fw-bold fs-5" id="total">$0.00</span>
                    </div>
                    
                    <button class="btn btn-success btn-lg w-100 mt-4" onclick="placeOrder()">
                        <i class="bi bi-check-circle me-2"></i>Place Order
                    </button>
                    
                    <div class="text-center mt-3">
                        <small class="text-muted">
                            <i class="bi bi-shield-check me-1"></i>
                            Your payment information is secure
                        </small>
                    </div>
                </div>
            </div>

            <!-- Estimated Delivery -->
            <div class="card shadow-lg border-0 mt-4">
                <div class="card-body p-4">
                    <h5 class="mb-3"><i class="bi bi-clock-history me-2"></i>Estimated Delivery</h5>
                    <div class="delivery-time-card">
                        <i class="bi bi-truck display-4 text-primary mb-2"></i>
                        <h4 class="mb-1">30-40 minutes</h4>
                        <p class="text-muted mb-0">Standard Delivery</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const deliveryFee = 2.99;
        const serviceFee = 1.50;
        const taxRate = 0.10;
        let selectedPaymentMethod = 'card';
        
        function loadOrderSummary() {
            const orderItemsContainer = document.getElementById('orderItems');
            
            if (cart.length === 0) {
                window.location.href = '/Cart';
                return;
            }
            
            orderItemsContainer.innerHTML = cart.map(item => `
                <div class="order-summary-item">
                    <span>${item.quantity}x ${item.name}</span>
                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            `).join('');
            
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * taxRate;
            const total = subtotal + deliveryFee + serviceFee + tax;
            
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;
        }
        
        function selectPaymentMethod(element, method) {
            document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('active'));
            element.classList.add('active');
            selectedPaymentMethod = method;
            
            // Show/hide card details
            const cardDetails = document.getElementById('cardDetails');
            if (method === 'card') {
                cardDetails.style.display = 'block';
            } else {
                cardDetails.style.display = 'none';
            }
        }
        
        function placeOrder() {
            const form = document.getElementById('checkoutForm');
            
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // Simulate order placement
            const orderNumber = Math.floor(100000 + Math.random() * 900000);
            
            // Clear cart
            localStorage.removeItem('cart');
            
            // Redirect to orders page with success message
            localStorage.setItem('lastOrder', JSON.stringify({
                orderNumber: orderNumber,
                timestamp: new Date().toISOString(),
                total: document.getElementById('total').textContent
            }));
            
            window.location.href = '/Orders?success=true&order=' + orderNumber;
        }
        
        // Initialize
        loadOrderSummary();
    </script>
}

