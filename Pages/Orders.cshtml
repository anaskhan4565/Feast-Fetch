@page
@model FeastFetch.Pages.OrdersModel
@{
    ViewData["Title"] = "My Orders";
}

<div class="page-header text-white text-center">
    <div class="container">
        <h1 class="display-3 fw-bold"><i class="bi bi-box-seam me-3"></i>My Orders</h1>
        <p class="lead">Track and view your order history</p>
    </div>
</div>

<div class="container py-5">
    <!-- Success Message -->
    <div id="successMessage" class="alert alert-success alert-dismissible fade show shadow-lg" role="alert" style="display: none;">
        <div class="d-flex align-items-center">
            <i class="bi bi-check-circle-fill fs-1 me-3"></i>
            <div>
                <h4 class="alert-heading mb-1">Order Placed Successfully!</h4>
                <p class="mb-0">Your order <strong>#<span id="orderNumberDisplay"></span></strong> has been confirmed and is being prepared.</p>
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Active Orders -->
    <div class="mb-5">
        <h2 class="mb-4"><i class="bi bi-lightning-fill text-warning me-2"></i>Active Orders</h2>
        
        <div class="row g-4">
            <!-- Order 1 - In Progress -->
            <div class="col-lg-6">
                <div class="order-card active-order">
                    <div class="order-header">
                        <div>
                            <h4 class="order-number">Order #<span id="liveOrderNumber">847592</span></h4>
                            <p class="order-date mb-0">
                                <i class="bi bi-clock-history me-1"></i>
                                <span id="orderTime">Just now</span>
                            </p>
                        </div>
                        <span class="order-status-badge preparing">
                            <i class="bi bi-hourglass-split me-1"></i>Preparing
                        </span>
                    </div>
                    
                    <div class="order-restaurant">
                        <div class="restaurant-logo-small">
                            <i class="bi bi-egg-fried"></i>
                        </div>
                        <div>
                            <strong>The Gourmet Kitchen</strong>
                            <p class="mb-0 text-muted small">Italian, Continental</p>
                        </div>
                    </div>

                    <!-- Order Tracking -->
                    <div class="order-tracking">
                        <div class="tracking-step completed">
                            <div class="step-icon"><i class="bi bi-check"></i></div>
                            <div class="step-content">
                                <strong>Order Placed</strong>
                                <small class="text-muted d-block">Your order has been received</small>
                            </div>
                        </div>
                        <div class="tracking-step active">
                            <div class="step-icon"><i class="bi bi-fire"></i></div>
                            <div class="step-content">
                                <strong>Preparing</strong>
                                <small class="text-muted d-block">Your food is being prepared</small>
                            </div>
                        </div>
                        <div class="tracking-step">
                            <div class="step-icon"><i class="bi bi-truck"></i></div>
                            <div class="step-content">
                                <strong>On the Way</strong>
                                <small class="text-muted d-block">Driver will pick up soon</small>
                            </div>
                        </div>
                        <div class="tracking-step">
                            <div class="step-icon"><i class="bi bi-house-door"></i></div>
                            <div class="step-content">
                                <strong>Delivered</strong>
                                <small class="text-muted d-block">Enjoy your meal!</small>
                            </div>
                        </div>
                    </div>

                    <div class="order-footer">
                        <div class="order-total">
                            <span class="text-muted">Total Amount</span>
                            <strong class="fs-5" id="liveOrderTotal">$0.00</strong>
                        </div>
                        <button class="btn btn-outline-primary">
                            <i class="bi bi-telephone me-1"></i>Contact Driver
                        </button>
                    </div>
                </div>
            </div>

            <!-- Order 2 - Out for Delivery -->
            <div class="col-lg-6">
                <div class="order-card active-order">
                    <div class="order-header">
                        <div>
                            <h4 class="order-number">Order #847591</h4>
                            <p class="order-date mb-0">
                                <i class="bi bi-clock-history me-1"></i>
                                25 minutes ago
                            </p>
                        </div>
                        <span class="order-status-badge delivery">
                            <i class="bi bi-truck me-1"></i>On the Way
                        </span>
                    </div>
                    
                    <div class="order-restaurant">
                        <div class="restaurant-logo-small" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <i class="bi bi-cup-hot"></i>
                        </div>
                        <div>
                            <strong>Spice Paradise</strong>
                            <p class="mb-0 text-muted small">Indian, Asian</p>
                        </div>
                    </div>

                    <div class="delivery-driver-info">
                        <div class="driver-avatar">
                            <i class="bi bi-person-circle"></i>
                        </div>
                        <div class="driver-details">
                            <strong>John Smith</strong>
                            <p class="mb-0 text-muted small">
                                <i class="bi bi-star-fill text-warning"></i> 4.9 â€¢ 500+ deliveries
                            </p>
                        </div>
                        <div class="driver-actions">
                            <button class="btn btn-sm btn-primary rounded-circle">
                                <i class="bi bi-telephone"></i>
                            </button>
                            <button class="btn btn-sm btn-success rounded-circle ms-2">
                                <i class="bi bi-chat-dots"></i>
                            </button>
                        </div>
                    </div>

                    <div class="delivery-eta">
                        <i class="bi bi-geo-alt-fill text-danger me-2"></i>
                        <strong>Arrives in 10-15 minutes</strong>
                        <div class="progress mt-2">
                            <div class="progress-bar bg-success" style="width: 75%"></div>
                        </div>
                    </div>

                    <div class="order-footer">
                        <div class="order-total">
                            <span class="text-muted">Total Amount</span>
                            <strong class="fs-5">$42.49</strong>
                        </div>
                        <button class="btn btn-outline-danger">
                            <i class="bi bi-x-circle me-1"></i>Cancel Order
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order History -->
    <div>
        <h2 class="mb-4"><i class="bi bi-clock-history text-primary me-2"></i>Order History</h2>
        
        <div class="row g-4">
            <!-- Past Order 1 -->
            <div class="col-lg-6">
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <h4 class="order-number">Order #847590</h4>
                            <p class="order-date mb-0">
                                <i class="bi bi-calendar me-1"></i>
                                2 days ago
                            </p>
                        </div>
                        <span class="order-status-badge delivered">
                            <i class="bi bi-check-circle me-1"></i>Delivered
                        </span>
                    </div>
                    
                    <div class="order-restaurant">
                        <div class="restaurant-logo-small" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="bi bi-balloon-heart"></i>
                        </div>
                        <div>
                            <strong>Burger Haven</strong>
                            <p class="mb-0 text-muted small">American, Fast Food</p>
                        </div>
                    </div>

                    <div class="order-items">
                        <div class="order-item">
                            <span>2x Classic Burger</span>
                            <span>$18.98</span>
                        </div>
                        <div class="order-item">
                            <span>1x Fries</span>
                            <span>$4.99</span>
                        </div>
                        <div class="order-item">
                            <span>2x Coke</span>
                            <span>$5.98</span>
                        </div>
                    </div>

                    <div class="order-footer">
                        <div class="order-total">
                            <span class="text-muted">Total Amount</span>
                            <strong class="fs-5">$34.94</strong>
                        </div>
                        <div>
                            <button class="btn btn-outline-primary me-2">
                                <i class="bi bi-star me-1"></i>Rate
                            </button>
                            <button class="btn btn-primary">
                                <i class="bi bi-arrow-clockwise me-1"></i>Reorder
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Past Order 2 -->
            <div class="col-lg-6">
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <h4 class="order-number">Order #847589</h4>
                            <p class="order-date mb-0">
                                <i class="bi bi-calendar me-1"></i>
                                5 days ago
                            </p>
                        </div>
                        <span class="order-status-badge delivered">
                            <i class="bi bi-check-circle me-1"></i>Delivered
                        </span>
                    </div>
                    
                    <div class="order-restaurant">
                        <div class="restaurant-logo-small" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            <i class="bi bi-brightness-high"></i>
                        </div>
                        <div>
                            <strong>Sushi Master</strong>
                            <p class="mb-0 text-muted small">Japanese, Sushi</p>
                        </div>
                    </div>

                    <div class="order-items">
                        <div class="order-item">
                            <span>1x Sushi Platter</span>
                            <span>$34.99</span>
                        </div>
                        <div class="order-item">
                            <span>1x Miso Soup</span>
                            <span>$5.99</span>
                        </div>
                        <div class="order-item">
                            <span>1x Green Tea</span>
                            <span>$3.99</span>
                        </div>
                    </div>

                    <div class="order-footer">
                        <div class="order-total">
                            <span class="text-muted">Total Amount</span>
                            <strong class="fs-5">$49.96</strong>
                        </div>
                        <div>
                            <button class="btn btn-outline-primary me-2">
                                <i class="bi bi-star me-1"></i>Rate
                            </button>
                            <button class="btn btn-primary">
                                <i class="bi bi-arrow-clockwise me-1"></i>Reorder
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Past Order 3 -->
            <div class="col-lg-6">
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <h4 class="order-number">Order #847588</h4>
                            <p class="order-date mb-0">
                                <i class="bi bi-calendar me-1"></i>
                                1 week ago
                            </p>
                        </div>
                        <span class="order-status-badge delivered">
                            <i class="bi bi-check-circle me-1"></i>Delivered
                        </span>
                    </div>
                    
                    <div class="order-restaurant">
                        <div class="restaurant-logo-small" style="background: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);">
                            <i class="bi bi-tree"></i>
                        </div>
                        <div>
                            <strong>Green Leaf Cafe</strong>
                            <p class="mb-0 text-muted small">Healthy, Vegan</p>
                        </div>
                    </div>

                    <div class="order-items">
                        <div class="order-item">
                            <span>1x Quinoa Bowl</span>
                            <span>$12.99</span>
                        </div>
                        <div class="order-item">
                            <span>1x Smoothie</span>
                            <span>$7.99</span>
                        </div>
                    </div>

                    <div class="order-footer">
                        <div class="order-total">
                            <span class="text-muted">Total Amount</span>
                            <strong class="fs-5">$25.97</strong>
                        </div>
                        <div>
                            <button class="btn btn-outline-primary me-2">
                                <i class="bi bi-star me-1"></i>Rate
                            </button>
                            <button class="btn btn-primary">
                                <i class="bi bi-arrow-clockwise me-1"></i>Reorder
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Check for success parameter
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get('success');
        const orderNumber = urlParams.get('order');
        
        if (success && orderNumber) {
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('orderNumberDisplay').textContent = orderNumber;
            document.getElementById('liveOrderNumber').textContent = orderNumber;
            
            // Load order total from storage
            const lastOrder = JSON.parse(localStorage.getItem('lastOrder'));
            if (lastOrder) {
                document.getElementById('liveOrderTotal').textContent = lastOrder.total;
            }
            
            // Auto-dismiss after 10 seconds
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
                // Clean URL
                window.history.replaceState({}, document.title, '/Orders');
            }, 10000);
        }
        
        // Simulate order time updating
        let orderTime = 0;
        setInterval(() => {
            orderTime++;
            const minutes = Math.floor(orderTime / 60);
            const seconds = orderTime % 60;
            
            if (minutes === 0) {
                document.getElementById('orderTime').textContent = `${seconds} seconds ago`;
            } else {
                document.getElementById('orderTime').textContent = `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            }
        }, 1000);
    </script>
}

