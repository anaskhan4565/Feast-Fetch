@page
@model FeastFetch.Pages.RestaurantOwner.DashboardModel
@{
    ViewData["Title"] = "Restaurant Dashboard";
}

<div class="page-header text-white text-center">
    <div class="container">
        <h1 class="display-3 fw-bold"><i class="bi bi-speedometer2 me-3"></i>Restaurant Dashboard</h1>
        <p class="lead">Manage your restaurant and orders</p>
    </div>
</div>

<div class="container py-5">
    <!-- Stats Cards -->
    <div class="row g-4 mb-5">
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="bi bi-cart-check text-primary"></i>
                </div>
                <h3 class="stat-number" id="totalOrders">0</h3>
                <p class="stat-label">Total Orders</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="bi bi-clock-history text-warning"></i>
                </div>
                <h3 class="stat-number" id="pendingOrders">0</h3>
                <p class="stat-label">Pending Orders</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="bi bi-currency-dollar text-success"></i>
                </div>
                <h3 class="stat-number" id="totalRevenue">$0</h3>
                <p class="stat-label">Total Revenue</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="bi bi-card-list text-info"></i>
                </div>
                <h3 class="stat-number" id="menuItems">0</h3>
                <p class="stat-label">Menu Items</p>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4 mb-5">
        <div class="col-lg-4 col-md-6">
            <div class="card shadow-lg border-0 hover-lift">
                <div class="card-body p-4 text-center">
                    <div class="mb-3">
                        <i class="bi bi-card-list" style="font-size: 3rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                    </div>
                    <h4 class="fw-bold mb-3">Manage Menu</h4>
                    <p class="text-muted mb-4">Add, edit, or remove menu items</p>
                    <a href="/RestaurantOwner/Menu" class="btn btn-primary w-100">
                        <i class="bi bi-arrow-right me-2"></i>Manage Menu
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6">
            <div class="card shadow-lg border-0 hover-lift">
                <div class="card-body p-4 text-center">
                    <div class="mb-3">
                        <i class="bi bi-gear" style="font-size: 3rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                    </div>
                    <h4 class="fw-bold mb-3">Restaurant Settings</h4>
                    <p class="text-muted mb-4">Update restaurant information</p>
                    <a href="/RestaurantOwner/Settings" class="btn btn-primary w-100">
                        <i class="bi bi-arrow-right me-2"></i>Settings
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6">
            <div class="card shadow-lg border-0 hover-lift">
                <div class="card-body p-4 text-center">
                    <div class="mb-3">
                        <i class="bi bi-box-seam" style="font-size: 3rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                    </div>
                    <h4 class="fw-bold mb-3">View Orders</h4>
                    <p class="text-muted mb-4">Track and manage orders</p>
                    <a href="/RestaurantOwner/Orders" class="btn btn-primary w-100">
                        <i class="bi bi-arrow-right me-2"></i>View Orders
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Orders -->
    <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0"><i class="bi bi-clock-history me-2"></i>Recent Orders</h3>
        </div>
        <div class="card-body">
            <div id="recentOrders">
                <p class="text-muted text-center py-4">No recent orders</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Load dashboard data
        function loadDashboardData() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            
            if (!currentUser || currentUser.userType !== 'RestaurantOwner') {
                window.location.href = '/Login';
                return;
            }
            
            // Get restaurant data
            const restaurant = currentUser.restaurant || {};
            const menuItems = restaurant.menuItems || [];
            
            // Update stats
            document.getElementById('menuItems').textContent = menuItems.length;
            
            // Get orders (from localStorage or mock data)
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const restaurantOrders = orders.filter(o => o.restaurantId === currentUser.id);
            
            document.getElementById('totalOrders').textContent = restaurantOrders.length;
            document.getElementById('pendingOrders').textContent = restaurantOrders.filter(o => o.status === 'Pending').length;
            
            const totalRevenue = restaurantOrders.reduce((sum, o) => sum + (parseFloat(o.total) || 0), 0);
            document.getElementById('totalRevenue').textContent = '$' + totalRevenue.toFixed(2);
            
            // Display recent orders
            displayRecentOrders(restaurantOrders.slice(0, 5));
        }
        
        function displayRecentOrders(orders) {
            const container = document.getElementById('recentOrders');
            
            if (orders.length === 0) {
                container.innerHTML = '<p class="text-muted text-center py-4">No recent orders</p>';
                return;
            }
            
            container.innerHTML = orders.map(order => `
                <div class="order-item-card mb-3 p-3 border rounded">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-1">Order #${order.id}</h5>
                            <p class="text-muted mb-0 small">${new Date(order.date).toLocaleString()}</p>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-${getStatusColor(order.status)} mb-2">${order.status}</span>
                            <p class="mb-0 fw-bold">$${parseFloat(order.total || 0).toFixed(2)}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function getStatusColor(status) {
            const colors = {
                'Pending': 'warning',
                'Preparing': 'info',
                'Ready': 'success',
                'Delivered': 'success',
                'Cancelled': 'danger'
            };
            return colors[status] || 'secondary';
        }
        
        loadDashboardData();
    </script>
}

